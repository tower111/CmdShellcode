
## 安装交叉编译环境
只测试过armle，兼容各种版本
```
git clone  https://github.com/tower111/CmdShellcode.git
git submodule update --init --recursive
cd musl-cross-make
cp ../config.mak .
make -j8
make install
```
默认安装交叉编译工具到/opt/cross/
路径可以在config.mak文件和generate\_shellcode.py中指定


# 用法

```
cd CmdShellcode
python3 ./generate_shellcode.py "ps -ef"  
```

生成shellcode为执行execve(["/bin/sh","-c","xxxxxxx",NULL])

```
(base) ➜  CmdShellcode python3 ./generate_shellcode.py "ps -ef"      
b'\x80\x08-\xe9\x04\xb0\x8d\xe2(\xd0M\xe2/0\xa0\xe3\x0c0K\xe5b0\xa0\xe3\x0b0K\xe5i0\xa0\xe3\n0K\xe5n0\xa0\xe3\t0K\xe5/0\xa0\xe3\x080K\xe5s0\xa0\xe3\x070K\xe5h0\xa0\xe3\x060K\xe5\x000\xa0\xe3\x050K\xe5-0\xa0\xe3\x100K\xe5c0\xa0\xe3\x0f0K\xe5\x000\xa0\xe3\x0e0K\xe5p0\xa0\xe3\x180K\xe5s0\xa0\xe3\x170K\xe5 0\xa0\xe3\x160K\xe5-0\xa0\xe3\x150K\xe5e0\xa0\xe3\x140K\xe5f0\xa0\xe3\x130K\xe5\x000\xa0\xe3\x120K\xe5\x0c0K\xe2(0\x0b\xe5\x100K\xe2$0\x0b\xe5\x180K\xe2 0\x0b\xe5\x000\xa0\xe3\x1c0\x0b\xe5\x0c0K\xe2(\xc0K\xe2\x0bp\xa0\xe3\x03\x00\xa0\xe1\x0c\x10\xa0\xe1\x00 \xa0\xe3\x00\x00\x00\xef\x00\x00\xa0\xe1\x04\xd0K\xe2\x80\x08\xbd\xe8\x1e\xff/\xe1'
```



## 测试shellcode

添加--test选项可以保留中间文件用于测试

- /tmp/tmpz67fry2z为对应elf文件
- /tmp/tmpz67fry2z.bin为objcopy得到的汇编指令字节码
- /tmp/tmpz67fry2z.c为脚本生成的嵌入汇编源码，执行execve

```
(base) ➜  CmdShellcode python3 ./generate_shellcode.py --test "ps -ef"
generate File /tmp/tmpz67fry2z /tmp/tmpz67fry2z.bin /tmp/tmpz67fry2z.c
b'\x80\x08-\xe9\x04\xb0\x8d\xe2(\xd0M\xe2/0\xa0\xe3\x0c0K\xe5b0\xa0\xe3\x0b0K\xe5i0\xa0\xe3\n0K\xe5n0\xa0\xe3\t0K\xe5/0\xa0\xe3\x080K\xe5s0\xa0\xe3\x070K\xe5h0\xa0\xe3\x060K\xe5\x000\xa0\xe3\x050K\xe5-0\xa0\xe3\x100K\xe5c0\xa0\xe3\x0f0K\xe5\x000\xa0\xe3\x0e0K\xe5-0\xa0\xe3\x180K\xe5-0\xa0\xe3\x170K\xe5t0\xa0\xe3\x160K\xe5e0\xa0\xe3\x150K\xe5s0\xa0\xe3\x140K\xe5t0\xa0\xe3\x130K\xe5\x000\xa0\xe3\x120K\xe5\x0c0K\xe2(0\x0b\xe5\x100K\xe2$0\x0b\xe5\x180K\xe2 0\x0b\xe5\x000\xa0\xe3\x1c0\x0b\xe5\x0c0K\xe2(\xc0K\xe2\x0bp\xa0\xe3\x03\x00\xa0\xe1\x0c\x10\xa0\xe1\x00 \xa0\xe3\x00\x00\x00\xef\x00\x00\xa0\xe1\x04\xd0K\xe2\x80\x08\xbd\xe8\x1e\xff/\xe1'
```

